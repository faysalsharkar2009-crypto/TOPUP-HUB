<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZONE TOPUP</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --primary-light: #eef2ff;
            --secondary: #6c757d;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #343a40;
            --card-bg: #ffffff;
            --body-bg: #f1f5f9;
            --text: #2d3748;
            --text-light: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 12px;
        }

        .dark-mode {
            --card-bg: #1e293b;
            --body-bg: #0f172a;
            --text: #f1f5f9;
            --text-light: #94a3b8;
            --border: #334155;
            --primary-light: #1e293b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--body-bg);
            color: var(--text);
            transition: all 0.3s ease;
        }

        .d-none {
            display: none !important;
        }

        /* UPDATED: Single Improved Loader */
        .loader-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--body-bg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 3px solid var(--primary-light);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: rotation 1s linear infinite;
            margin-bottom: 15px;
        }

        .loader-text {
            color: var(--text);
            font-size: 0.9rem;
            font-weight: 500;
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1100;
        }

        .toast {
            padding: 12px 20px;
            margin-bottom: 10px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease;
            max-width: 350px;
        }

        .toast-success { background: var(--success); color: white; }
        .toast-error { background: var(--danger); color: white; }
        .toast-warning { background: var(--warning); color: white; }
        .toast-info { background: var(--info); color: white; }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* UPDATED: Enhanced Splash Screen with Progress Bar */
        #splash-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--body-bg);
            z-index: 10000;
        }

        .splash-logo {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 30px;
            text-align: center;
        }

        .progress-container {
            width: 80%;
            max-width: 300px;
            height: 6px;
            background-color: var(--primary-light);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--primary);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .splash-loading {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-light);
        }

        .splash-loading .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--primary);
            animation: bounce 1.5s infinite;
        }

        .splash-loading .dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .splash-loading .dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        /* Ban Screen */
        #ban-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--body-bg);
            z-index: 10000;
            padding: 20px;
            text-align: center;
        }

        .ban-icon {
            font-size: 4rem;
            color: var(--danger);
            margin-bottom: 20px;
        }

        .ban-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--danger);
            margin-bottom: 15px;
        }

        .ban-message {
            font-size: 1.1rem;
            color: var(--text);
            margin-bottom: 30px;
            max-width: 500px;
            line-height: 1.6;
        }

        /* Auth Views */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .auth-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 40px;
            width: 100%;
            max-width: 450px;
            border-top: 4px solid var(--primary);
        }

        .auth-title {
            font-size: 1.8rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .auth-subtitle {
            text-align: center;
            color: var(--text-light);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text);
        }

        .form-control {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: all 0.3s;
            background-color: var(--card-bg);
            color: var(--text);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
        }

        /* FIXED: Password toggle positioning - Improved */
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 1rem;
            z-index: 10;
            height: 20px;
            width: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
            width: 100%;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .auth-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
        }

        .auth-link:hover {
            text-decoration: underline;
        }

        .auth-footer {
            margin-top: 20px;
            color: var(--text-light);
            text-align: center;
        }

        .error-message {
            color: var(--danger);
            text-align: center;
            margin-top: 15px;
            min-height: 1.2em;
            font-size: 0.9rem;
        }

        /* UPDATED: Sign up link styling - More prominent */
        .signup-highlight {
            background: var(--primary-light);
            border: 2px solid var(--primary);
            border-radius: var(--radius);
            padding: 12px;
            margin: 15px 0;
            text-align: center;
            font-weight: 600;
            color: var(--primary);
        }

        /* Main App View */
        #app-view {
            padding-bottom: 80px;
        }

        /* Header */
        .app-header {
            background: var(--card-bg);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .app-logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .wallet-balance {
            display: flex;
            align-items: center;
            background: var(--primary-light);
            padding: 8px 12px;
            border-radius: 20px;
            font-weight: 600;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .wallet-balance i {
            margin-right: 8px;
        }

        /* Notice Bar */
        .notice-bar {
            background: var(--primary);
            color: white;
            padding: 10px 0;
            font-weight: 500;
            font-size: 0.9rem;
            overflow: hidden;
            position: relative;
        }

        .notice-content {
            display: inline-block;
            white-space: nowrap;
            animation: scroll 20s linear infinite;
        }

        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        /* UPDATED: Slider with manual and auto scroll */
        .slider-container {
            position: relative;
            max-width: 1200px;
            margin: 20px auto;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            height: 210px;
            touch-action: pan-y;
        }

        .slider {
            display: flex;
            transition: transform 0.5s ease-in-out;
            height: 100%;
        }

        .slide {
            min-width: 100%;
            height: 100%;
            flex-shrink: 0;
        }

        .slide a {
            display: block;
            width: 100%;
            height: 100%;
        }

        .slide img {
            width: 100%;
            height: 100%;
            display: block;
            object-fit: cover;
        }

        .slider-dots {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
        }

        .slider-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.3s;
        }

        .slider-dot.active {
            background: white;
            transform: scale(1.2);
        }

        .category-section {
            margin-bottom: 40px;
        }

        .category-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 30px 0 15px 0;
            padding-bottom: 5px;
            border-bottom: 3px solid var(--primary);
            display: block;
            text-align: center;
            width: 100%;
        }

        /* UPDATED: Product Grid with better image styling and larger name */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
            padding: 0 10px;
        }

        /* UPDATED: Card dimensions */
        .product-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            display: flex;
            flex-direction: column;
            width: 140px;
            height: 175px;
            box-shadow: var(--shadow);
            margin: 0 auto;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        .product-card img {
            width: 100%;
            height: 140px;
            object-fit: cover;
            margin: 0;
            border-radius: var(--radius) var(--radius) 0 0;
            border: none;
            box-shadow: none;
        }

        .product-info {
            padding: 8px 5px;
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--card-bg);
        }

        .product-name {
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin: 0;
            line-height: 1.3;
            padding: 0 5px;
        }

        .product-card.out-of-stock {
            opacity: 0.5;
            cursor: not-allowed;
            position: relative;
        }

        .product-card.out-of-stock::after {
            content: 'Out of Stock';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        /* Add coming soon badge */
        .coming-soon-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--warning);
            color: var(--dark);
            padding: 3px 6px;
            border-radius: 10px;
            font-size: 0.65rem;
            font-weight: 600;
            z-index: 2;
        }

        /* NEW: Footer Section */
        .app-footer {
            background: var(--card-bg);
            padding: 25px 20px;
            margin-top: 30px;
            border-top: 1px solid var(--border);
            width: 100%;
            max-width: 411px;
            margin-left: auto;
            margin-right: auto;
            height: auto;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .support-section {
            margin-bottom: 25px;
        }

        .support-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
            color: var(--primary);
        }

        .support-links {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }

        .support-link {
            display: flex;
            align-items: center;
            gap: 15px;
            text-decoration: none;
            color: var(--text);
            transition: all 0.3s;
            padding: 10px 15px;
            border-radius: var(--radius);
            background: var(--primary-light);
        }

        .support-link:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .support-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .support-details {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .support-name {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .support-value {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .social-links {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 25px;
        }

        .social-link {
            display: flex;
            align-items: center;
            gap: 15px;
            text-decoration: none;
            color: var(--text);
            padding: 10px 15px;
            border-radius: var(--radius);
            background: var(--primary-light);
            transition: all 0.3s;
        }

        .social-link:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .social-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .copyright {
            text-align: center;
            color: var(--text-light);
            font-size: 0.85rem;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        /* App Pages */
        .app-page {
            padding: 20px;
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        /* My Orders Page */
        .order-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .order-id {
            font-weight: 600;
            color: var(--primary);
            font-size: 0.9rem;
        }

        .order-date {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .order-details {
            margin-bottom: 10px;
        }

        .order-detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .order-detail-label {
            font-weight: 500;
            color: var(--text-light);
        }

        .order-detail-value {
            font-weight: 600;
        }

        .order-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pending { background: #fff3cd; color: #856404; }
        .status-completed { background: #d4edda; color: #155724; }
        .status-rejected { background: #f8d7da; color: #721c24; }

        /* My Transaction Page */
        .transaction-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .transaction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .transaction-amount {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--success);
        }

        .transaction-details {
            margin-bottom: 10px;
        }

        .transaction-detail {
            display: flex;
            margin-bottom: 5px;
        }

        .transaction-label {
            font-weight: 500;
            color: var(--text-light);
            min-width: 100px;
        }

        .transaction-value {
            flex: 1;
            font-weight: 600;
        }

        /* Account Page Redesign */
        .account-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: white;
            font-size: 2rem;
            font-weight: 700;
        }

        .user-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .user-email {
            color: var(--text-light);
            margin-bottom: 15px;
        }

        .account-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 15px;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        /* NEW: Add Money Page with Auto/Manual Options */
        .add-money-options {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }

        .add-money-option {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-money-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .add-money-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .add-money-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text);
        }

        .add-money-description {
            color: var(--text-light);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Deposit Page - Tab-based Design with Logos */
        .payment-tabs {
            display: flex;
            background: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .payment-tab {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .payment-tab.active {
            border-bottom: 3px solid var(--primary);
            background: var(--primary-light);
            color: var(--primary);
            font-weight: 600;
        }

        .payment-tab img {
            width: 40px;
            height: 40px;
            object-fit: contain;
            border-radius: 8px;
        }

        .payment-form {
            display: none;
        }

        .payment-form.active {
            display: block;
        }

        .payment-box {
            width: 100%;
            margin: 0 auto 20px auto;
            border-radius: 10px;
            color: #fff;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .bkash-box { background-color: #E2136E; }
        .nagad-box { background-color: #F15A22; }
        .rocket-box { background-color: #6A1B9A; }

        .payment-box h2 {
            text-align: center;
            font-size: 20px;
            margin-bottom: 15px;
        }

        .payment-box input {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            border: none;
            font-size: 14px;
            background: rgba(255,255,255,0.15);
            color: #fff;
            outline: none;
        }

        .payment-box input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        /* UPDATED: Modern Payment Instructions Design with Copy Buttons */
        .payment-guide {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
            border-left: 4px solid rgba(255, 255, 255, 0.3);
        }
        
        .payment-guide-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .payment-guide-title i {
            font-size: 18px;
        }
        
        .payment-steps {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .payment-step {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }
        
        .step-number {
            background: rgba(255, 255, 255, 0.2);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .step-content {
            flex: 1;
            font-size: 14px;
            line-height: 1.5;
        }

        .number-copy {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255,255,255,0.15);
            padding: 10px 12px;
            border-radius: 6px;
            margin: 10px 0;
        }

        .highlight {
            font-weight: bold;
            color: #fff;
            font-size: 14px;
        }

        .copy-btn {
            background: #fff;
            color: #000;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 13px;
            cursor: pointer;
            transition: 0.2s;
        }

        .copy-btn:hover {
            opacity: 0.8;
        }

        .verify-btn {
            width: 100%;
            background: #fff;
            color: #000;
            font-weight: 600;
            font-size: 15px;
            border: none;
            border-radius: 6px;
            padding: 12px;
            margin-top: 15px;
            cursor: pointer;
            transition: 0.2s;
        }

        .verify-btn:hover {
            opacity: 0.9;
        }

        #toast {
            visibility: hidden;
            min-width: 180px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.4s, bottom 0.4s;
        }

        #toast.show {
            visibility: visible;
            opacity: 1;
            bottom: 50px;
        }

        /* Footer Navigation */
        .footer-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: var(--card-bg);
            display: flex;
            justify-content: space-around;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.08);
            z-index: 100;
            padding: 10px 0;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            cursor: pointer;
            color: var(--text-light);
            transition: color 0.3s ease;
            padding: 5px 0;
        }

        .nav-item i {
            font-size: 1.2rem;
            margin-bottom: 4px;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-text {
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* Product Detail Page Styles - No Image */
        .product-detail-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .back-button {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--primary);
            cursor: pointer;
            padding: 5px;
        }

        .section-box {
            background: var(--card-bg);
            margin-top: 10px;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            margin-bottom: 15px;
        }

        .section-header {
            font-size: 18px;
            font-weight: bold;
            color: var(--text);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .section-header-number {
            background-color: var(--primary);
            color: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 10px;
            font-size: 16px;
        }

        /* UPDATED: Recharge grid - Adjusted height */
        .recharge-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 0 0 15px 0;
        }

        .recharge-item {
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 12px 8px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 60px;
            transition: all 0.3s ease;
            text-align: center;
        }

        .recharge-item.selected {
            border: 2px solid var(--primary);
            background-color: var(--primary-light);
        }

        .recharge-item.out-of-stock {
            opacity: 0.5;
            cursor: not-allowed;
            position: relative;
        }

        .recharge-item.out-of-stock::after {
            content: 'Out of Stock';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .diamond-info {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .diamond-icon {
            color: var(--primary);
        }

        .price-info {
            font-size: 14px;
            font-weight: bold;
            color: #ff5722;
        }

        .input-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 8px;
            display: block;
        }

        .player-id-input {
            width: 100%;
            padding: 12px 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
            outline: none;
            background-color: var(--card-bg);
            color: var(--text);
        }

        .payment-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .payment-method {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            height: 70px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            transition: all 0.3s ease;
        }

        .payment-method.selected {
            border: 2px solid var(--primary);
            background-color: var(--primary-light);
        }

        .topup-logo-text {
            font-weight: bold;
            color: var(--primary);
            font-size: 18px;
        }

        .wallet-dropdown {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary);
        }

        .wallet-dropdown::after {
            content: '▼';
            font-size: 10px;
            margin-left: 5px;
        }

        /* UPDATED: Instant Payment with logos and payment method selection */
        .payment-logos {
            display: flex;
            gap: 8px;
            margin-bottom: 5px;
        }

        .payment-logos img {
            width: 24px;
            height: 24px;
            object-fit: contain;
            border-radius: 4px;
        }

        .instant-pay {
            font-size: 10px;
            color: var(--text-light);
        }

        .info-box {
            background-color: var(--primary-light);
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            font-size: 13px;
            color: var(--text);
            display: flex;
            align-items: center;
        }

        .info-box::before {
            content: 'ⓘ';
            font-weight: bold;
            color: var(--primary);
            margin-right: 8px;
            font-size: 16px;
        }

        .highlight-balance {
            font-weight: bold;
            color: var(--primary);
            margin-left: 4px;
        }

        .highlight-cost {
            font-weight: bold;
            color: #ff5722;
            margin-left: 4px;
        }

        .footer-action-bar {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: var(--card-bg);
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: flex-end;
            padding: 10px 15px;
            box-sizing: border-box;
            z-index: 10;
        }

        .buy-now-btn {
            background-color: var(--primary);
            color: white;
            font-weight: bold;
            font-size: 16px;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-transform: uppercase;
        }

        .buy-now-btn:disabled {
            background-color: var(--secondary);
            cursor: not-allowed;
        }

        /* UPDATED: Instant Payment Form with payment method selection */
        .instant-payment-form {
            margin-top: 15px;
            padding: 15px;
            background: var(--primary-light);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .instant-payment-form h4 {
            margin-bottom: 15px;
            color: var(--text);
        }

        .payment-numbers {
            margin-bottom: 15px;
        }

        .payment-number-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .payment-number-item:last-child {
            border-bottom: none;
        }

        .payment-method-selector {
            margin: 15px 0;
        }

        .payment-method-selector label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
        }

        .payment-method-dropdown {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--card-bg);
            color: var(--text);
            font-size: 14px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Edit Profile Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 30px;
            border-radius: var(--radius);
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .modal-close {
            font-size: 1.5rem;
            cursor: pointer;
            border: none;
            background: none;
            color: var(--text);
        }

        /* Responsive adjustments */
        @media (max-width: 480px) {
            .payment-tab {
                padding: 12px 8px;
            }
            
            .payment-tab img {
                width: 32px;
                height: 32px;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .auth-card {
                padding: 30px 20px;
            }
            
            .product-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .product-card {
                width: 120px;
                height: 155px;
            }
            
            .product-card img {
                height: 120px;
            }
            
            .app-page {
                padding: 15px;
            }
            
            .recharge-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .payment-options {
                flex-direction: column;
            }
            
            .product-card {
                padding: 0;
            }
            
            .product-name {
                font-size: 0.85rem;
            }

            .account-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .product-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .product-card {
                width: 140px;
                height: 175px;
            }
            
            .product-card img {
                height: 140px;
            }
            
            .recharge-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .recharge-item {
                padding: 10px 6px;
                min-height: 60px;
            }
            
            .diamond-info {
                font-size: 12px;
            }
            
            .price-info {
                font-size: 12px;
            }

            .account-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>
    <div id="toast">Number copied!</div>

    <!-- UPDATED: Enhanced Splash Screen with Progress Bar -->
    <div id="splash-screen">
        <div class="splash-logo" id="splash-logo">ZONE TOPUP</div>
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="splash-loading">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>
    </div>
    
    <!-- Ban Screen -->
    <div id="ban-screen" class="d-none">
        <div class="ban-icon">
            <i class="fas fa-ban"></i>
        </div>
        <h1 class="ban-title">Account Banned</h1>
        <p class="ban-message">Your account has been banned by the administrator. You can no longer access this application.</p>
        <button class="btn btn-danger" id="ban-close-btn">
            <i class="fas fa-times"></i> Close App
        </button>
    </div>

    <!-- UPDATED: Single Loader (now used only for specific actions) -->
    <div id="loader" class="loader-wrapper d-none">
        <div class="loader"></div>
        <div class="loader-text">Loading...</div>
    </div>

    <!-- Authentication Views -->
    <div id="auth-view" class="d-none">
        <!-- Login View -->
        <div id="login-view">
            <div class="auth-container">
                <div class="auth-card">
                    <h1 class="auth-title" id="login-app-name">Welcome</h1>
                    <p class="auth-subtitle">Sign in to continue</p>
                    <form id="login-form">
                        <div class="form-group">
                            <input type="email" id="login-email" class="form-control" placeholder="Email" required>
                        </div>
                        <div class="form-group">
                            <input type="password" id="login-password" class="form-control" placeholder="Password" required>
                            <button type="button" class="password-toggle" id="login-password-toggle">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="error-message" id="login-error"></div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </button>
                    </form>
                    
                    <!-- UPDATED: More prominent sign up section -->
                    <div class="signup-highlight">
                        Don't have an account? 
                        <a href="#" class="auth-link" id="show-signup-link">Sign Up Now</a>
                    </div>
                    
                    <p class="auth-footer">
                        <a href="#" class="auth-link" id="forgot-password-link">Forgot Password?</a>
                    </p>
                </div>
            </div>
        </div>

        <!-- Sign Up View -->
        <div id="signup-view" class="d-none">
            <div class="auth-container">
                <div class="auth-card">
                    <h1 class="auth-title" id="signup-app-name">Create Account</h1>
                    <p class="auth-subtitle">Get started with your new account</p>
                    <form id="signup-form">
                        <div class="form-group">
                            <input type="text" id="signup-fullname" class="form-control" placeholder="Full Name" required>
                        </div>
                        <div class="form-group">
                            <input type="email" id="signup-email" class="form-control" placeholder="Email" required>
                        </div>
                        <div class="form-group">
                            <input type="password" id="signup-password" class="form-control" placeholder="Password" required>
                            <button type="button" class="password-toggle" id="signup-password-toggle">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="form-group">
                            <input type="password" id="signup-confirm-password" class="form-control" placeholder="Confirm Password" required>
                            <button type="button" class="password-toggle" id="signup-confirm-password-toggle">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="error-message" id="signup-error"></div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-user-plus"></i> Sign Up
                        </button>
                    </form>
                    <p class="auth-footer">
                        Already have an account? <a href="#" class="auth-link" id="show-login-link">Login</a>
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Forgot Password View -->
        <div id="forgot-password-view" class="d-none">
            <div class="auth-container">
                <div class="auth-card">
                    <h1 class="auth-title">Reset Password</h1>
                    <p class="auth-subtitle">Enter your email to receive a reset link</p>
                    <form id="forgot-password-form">
                        <div class="form-group">
                            <input type="email" id="reset-email" class="form-control" placeholder="Email" required>
                        </div>
                        <div class="error-message" id="reset-message"></div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> Send Reset Link
                        </button>
                    </form>
                    <p class="auth-footer">
                        <a href="#" class="auth-link" id="back-to-login-link">Back to Login</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Application View -->
    <div id="app-view" class="d-none">
        <!-- Header -->
        <header class="app-header">
            <div class="app-logo" id="app-name-header">ZONE TOPUP</div>
            <div class="wallet-balance">
                <i class="fas fa-wallet"></i>
                <span id="wallet-balance-value">0</span>
            </div>
        </header>

        <!-- Notice Bar -->
        <div class="notice-bar">
            <div class="notice-content" id="notice-text">Welcome to our Zone TOPUP</div>
        </div>

        <main id="main-content">
            <!-- Home Page -->
            <div id="home-page" class="app-page">
                <div class="slider-container" id="slider-container">
                    <div class="slider" id="image-slider">
                        <!-- JS will populate this -->
                    </div>
                    <div class="slider-dots" id="slider-dots">
                        <!-- JS will populate this -->
                    </div>
                </div>
                <div id="product-list" class="container">
                    <!-- JS will populate this with category sections -->
                </div>
                
                <!-- NEW: Footer Section -->
                <footer class="app-footer">
                    <div class="support-section">
                        <h3 class="support-title">Support</h3>
                        
                        <div class="support-links">
                            <a href="#" class="support-link" id="support-email-link">
                                <div class="support-icon" style="background-color: #4361ee; color: white;">
                                    <i class="fas fa-envelope"></i>
                                </div>
                                <div class="support-details">
                                    <div class="support-name">Email Support</div>
                                    <div class="support-value" id="support-email">support@zonetopup.com</div>
                                </div>
                            </a>
                            
                            <a href="#" class="support-link" id="whatsapp-link">
                                <div class="support-icon" style="background-color: #25D366; color: white;">
                                    <i class="fab fa-whatsapp"></i>
                                </div>
                                <div class="support-details">
                                    <div class="support-name">WhatsApp</div>
                                    <div class="support-value" id="whatsapp-number">+8801234567890</div>
                                </div>
                            </a>
                            
                            <a href="#" class="support-link" id="telegram-link">
                                <div class="support-icon" style="background-color: #0088cc; color: white;">
                                    <i class="fab fa-telegram"></i>
                                </div>
                                <div class="support-details">
                                    <div class="support-name">Telegram</div>
                                    <div class="support-value" id="telegram-link-text">@zonetopup</div>
                                </div>
                            </a>
                        </div>
                        
                        <div class="social-links">
                            <a href="#" class="social-link" id="youtube-link">
                                <div class="social-icon" style="background-color: #FF0000; color: white;">
                                    <i class="fab fa-youtube"></i>
                                </div>
                                <div class="support-details">
                                    <div class="support-name">YouTube</div>
                                    <div class="support-value">Subscribe to our channel</div>
                                </div>
                            </a>
                            
                            <a href="#" class="social-link" id="facebook-link">
                                <div class="social-icon" style="background-color: #4267B2; color: white;">
                                    <i class="fab fa-facebook"></i>
                                </div>
                                <div class="support-details">
                                    <div class="support-name">Facebook</div>
                                    <div class="support-value">Follow us on Facebook</div>
                                </div>
                            </a>
                        </div>
                    </div>
                    
                    <div class="copyright">
                        <p>&copy; 2023 Zone TopUp. All rights reserved.</p>
                    </div>
                </footer>
            </div>
            
            <!-- NEW: Add Money Page with Auto/Manual Options -->
            <div id="add-money-page" class="app-page d-none">
                <h1 class="page-title">Add Money</h1>
                
                <div class="add-money-options">
                    <div class="add-money-option" id="auto-add-money">
                        <div class="add-money-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <h3 class="add-money-title">Auto Add Money</h3>
                        <p class="add-money-description">
                            Instantly add money to your wallet with automatic verification. 
                            Fast and convenient for regular top-ups.
                        </p>
                    </div>
                    
                    <div class="add-money-option" id="manual-add-money">
                        <div class="add-money-icon">
                            <i class="fas fa-hand-holding-usd"></i>
                        </div>
                        <h3 class="add-money-title">Manual Add Money</h3>
                        <p class="add-money-description">
                            Send money to our payment numbers and verify manually. 
                            Suitable for first-time users or larger amounts.
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Deposit Page with Tab-based Design and Logos -->
            <div id="deposit-page" class="app-page d-none">
                <h1 class="page-title">Add Money</h1>
                
                <!-- Payment Method Tabs -->
                <div class="payment-tabs">
                    <div class="payment-tab active" data-method="bkash">
                        <img src="https://i.ibb.co.com/HTH88vtj/images.png" alt="বিকাশ">
                        <span>বিকাশ</span>
                    </div>
                    <div class="payment-tab" data-method="nagad">
                        <img src="https://i.ibb.co.com/GQ61SV5S/images.jpg" alt="নগদ">
                        <span>নগদ</span>
                    </div>
                    <div class="payment-tab" data-method="rocket">
                        <img src="https://i.ibb.co.com/t5n6pZW/download.png" alt="রকেট">
                        <span>রকেট</span>
                    </div>
                </div>
                
                <!-- Bkash Payment Form -->
                <div id="bkash-payment" class="payment-form active">
                    <div class="payment-box bkash-box">
                        <h2>বিকাশ পেমেন্ট</h2>
                        <input type="number" placeholder="পরিমাণ (৳)" class="deposit-amount" data-method="Bkash">
                        <input type="text" placeholder="যে নাম্বার থেকে টাকা পাঠিয়েছেন" class="sender-number" data-method="Bkash">
                        <input type="text" placeholder="ট্রানজেকশন আইডি দিন" class="transaction-id" data-method="Bkash">
                        
                        <!-- Modern Payment Instructions Design -->
                        <div class="payment-guide">
                            <div class="payment-guide-title">
                                <i class="fas fa-info-circle"></i>
                                <span>পেমেন্ট করার নিয়ম</span>
                            </div>
                            <div class="payment-steps">
                                <div class="payment-step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">*247# ডায়াল করুন অথবা বিকাশ অ্যাপে যান</div>
                                </div>
                                <div class="payment-step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">"Send Money" তে ক্লিক করুন</div>
                                </div>
                                <div class="payment-step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        প্রাপক নাম্বার:
                                        <div class="number-copy">
                                            <span class="highlight" id="bkashNumber">Loading...</span>
                                            <button class="copy-btn" data-method="bkash">Copy</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="payment-step">
                                    <div class="step-number">4</div>
                                    <div class="step-content">টাকা পাঠানোর পর ট্রানজেকশন আইডি ও আপনার নাম্বার এখানে লিখে নিচের Verify বাটনে ক্লিক করুন</div>
                                </div>
                            </div>
                        </div>
                        <button class="verify-btn" data-method="Bkash">VERIFY</button>
                    </div>
                </div>
                
                <!-- Nagad Payment Form -->
                <div id="nagad-payment" class="payment-form d-none">
                    <div class="payment-box nagad-box">
                        <h2>নগদ পেমেন্ট</h2>
                        <input type="number" placeholder="পরিমাণ (৳)" class="deposit-amount" data-method="Nagad">
                        <input type="text" placeholder="যে নাম্বার থেকে টাকা পাঠিয়েছেন" class="sender-number" data-method="Nagad">
                        <input type="text" placeholder="ট্রানজেকশন আইডি দিন" class="transaction-id" data-method="Nagad">
                        
                        <!-- Modern Payment Instructions Design -->
                        <div class="payment-guide">
                            <div class="payment-guide-title">
                                <i class="fas fa-info-circle"></i>
                                <span>পেমেন্ট করার নিয়ম</span>
                            </div>
                            <div class="payment-steps">
                                <div class="payment-step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">*167# অথবা নগদ অ্যাপে যান</div>
                                </div>
                                <div class="payment-step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">"Send Money" তে ক্লিক করুন</div>
                                </div>
                                <div class="payment-step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        প্রাপক নাম্বার:
                                        <div class="number-copy">
                                            <span class="highlight" id="nagadNumber">Loading...</span>
                                            <button class="copy-btn" data-method="nagad">Copy</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="payment-step">
                                    <div class="step-number">4</div>
                                    <div class="step-content">টাকা পাঠানোর পর ট্রানজেকশন আইডি ও আপনার নাম্বার এখানে লিখে নিচের Verify বাটনে ক্লিক করুন</div>
                                </div>
                            </div>
                        </div>
                        <button class="verify-btn" data-method="Nagad">VERIFY</button>
                    </div>
                </div>
                
                <!-- Rocket Payment Form -->
                <div id="rocket-payment" class="payment-form d-none">
                    <div class="payment-box rocket-box">
                        <h2>রকেট পেমেন্ট</h2>
                        <input type="number" placeholder="পরিমাণ (৳)" class="deposit-amount" data-method="Rocket">
                        <input type="text" placeholder="যে নাম্বার থেকে টাকা পাঠিয়েছেন" class="sender-number" data-method="Rocket">
                        <input type="text" placeholder="ট্রানজেকশন আইডি দিন" class="transaction-id" data-method="Rocket">
                        
                        <!-- Modern Payment Instructions Design -->
                        <div class="payment-guide">
                            <div class="payment-guide-title">
                                <i class="fas fa-info-circle"></i>
                                <span>পেমেন্ট করার নিয়ম</span>
                            </div>
                            <div class="payment-steps">
                                <div class="payment-step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">*322# অথবা রকেট অ্যাপে যান</div>
                                </div>
                                <div class="payment-step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">"Send Money" তে ক্লিক করুন</div>
                                </div>
                                <div class="payment-step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        প্রাপক নাম্বার:
                                        <div class="number-copy">
                                            <span class="highlight" id="rocketNumber">Loading...</span>
                                            <button class="copy-btn" data-method="rocket">Copy</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="payment-step">
                                    <div class="step-number">4</div>
                                    <div class="step-content">টাকা পাঠানোর পর ট্রানজেকশন আইডি ও আপনার নাম্বার এখানে লিখে নিচের Verify বাটনে ক্লিক করুন</div>
                                </div>
                            </div>
                        </div>
                        <button class="verify-btn" data-method="Rocket">VERIFY</button>
                    </div>
                </div>
            </div>

            <!-- My Orders Page -->
            <div id="my-orders-page" class="app-page d-none">
                <h1 class="page-title">My Orders</h1>
                <div id="orders-list">
                    <!-- Orders will be populated here -->
                </div>
            </div>

            <!-- My Transaction Page -->
            <div id="my-transaction-page" class="app-page d-none">
                <h1 class="page-title">My Transactions</h1>
                <div id="transactions-list">
                    <!-- Transactions will be populated here -->
                </div>
            </div>

            <!-- Account Page -->
            <div id="account-page" class="app-page d-none">
                <div class="account-header">
                    <div class="user-avatar" id="user-avatar">R</div>
                    <h2 class="user-name" id="user-fullname">Rabbi</h2>
                    <p class="user-email" id="user-email-display">sarkarrabby15@gmail.com</p>
                    <button class="btn btn-primary" id="edit-profile-btn">
                        <i class="fas fa-edit"></i> Edit Profile
                    </button>
                </div>

                <div class="account-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="user-id-display">#166103</div>
                        <div class="stat-label">User ID</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-wallet">৳20</div>
                        <div class="stat-label">Total Wallet</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-spent">৳10</div>
                        <div class="stat-label">Total Spent</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-orders">2</div>
                        <div class="stat-label">Total Orders</div>
                    </div>
                </div>

                <button id="logout-btn" class="btn btn-danger">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>

            <!-- Product Detail Page - No Image -->
            <div id="product-detail-page" class="app-page d-none">
                <div class="product-detail-header">
                    <button class="back-button" id="back-to-home">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h1 class="page-title" id="product-detail-title">Product Details</h1>
                </div>

                <div class="section-box">
                    <div class="section-header">
                        <span class="section-header-number">1</span>
                        Select Recharge
                    </div>
                    <div class="recharge-grid" id="recharge-options">
                        <!-- Recharge options will be populated dynamically from product_items -->
                    </div>
                </div>

                <div class="section-box">
                    <div class="section-header">
                        <span class="section-header-number">2</span>
                        Account Info
                    </div>
                    <label for="player-id" class="input-label">Player ID</label>
                    <input type="text" id="player-id-input" class="player-id-input" placeholder="Enter your player ID" required>
                </div>

                <div class="section-box">
                    <div class="section-header">
                        <span class="section-header-number">3</span>
                        Select Payment
                    </div>

                    <div class="payment-options">
                        <div class="payment-method selected" data-method="wallet">
                            <span class="topup-logo-text" id="app-name-payment">TopUp Center</span>
                            <span class="wallet-dropdown">Wallet (৳: <span id="wallet-balance-display">0</span>)</span>
                        </div>
                        <div class="payment-method" data-method="instant">
                            <!-- UPDATED: Instant payment with proper logos -->
                            <div class="payment-logos">
                                <img src="https://i.ibb.co.com/HTH88vtj/images.png" alt="বিকাশ">
                                <img src="https://i.ibb.co.com/GQ61SV5S/images.jpg" alt="নগদ">
                                <img src="https://i.ibb.co.com/t5n6pZW/download.png" alt="রকেট">
                            </div>
                            <span class="instant-pay">Instant Pay</span>
                        </div>
                    </div>

                    <!-- UPDATED: Instant Payment Form with payment method selection -->
                    <div id="instant-payment-form" class="instant-payment-form d-none">
                        <h4>Send Money to Our Numbers:</h4>
                        <div class="payment-numbers">
                            <div class="payment-number-item">
                                <div>
                                    <img src="https://i.ibb.co.com/HTH88vtj/images.png" alt="বিকাশ" style="width: 20px; height: 20px; margin-right: 8px; border-radius: 4px;">
                                    <span>Bkash:</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <strong id="instant-bkash-number">Loading...</strong>
                                    <button class="copy-btn" data-method="bkash">Copy</button>
                                </div>
                            </div>
                            <div class="payment-number-item">
                                <div>
                                    <img src="https://i.ibb.co.com/GQ61SV5S/images.jpg" alt="নগদ" style="width: 20px; height: 20px; margin-right: 8px; border-radius: 4px;">
                                    <span>Nagad:</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <strong id="instant-nagad-number">Loading...</strong>
                                    <button class="copy-btn" data-method="nagad">Copy</button>
                                </div>
                            </div>
                            <div class="payment-number-item">
                                <div>
                                    <img src="https://i.ibb.co.com/t5n6pZW/download.png" alt="রকেট" style="width: 20px; height: 20px; margin-right: 8px; border-radius: 4px;">
                                    <span>Rocket:</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <strong id="instant-rocket-number">Loading...</strong>
                                    <button class="copy-btn" data-method="rocket">Copy</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Payment Method Selection Dropdown -->
                        <div class="payment-method-selector">
                            <label for="instant-payment-method">Select Payment Method:</label>
                            <select id="instant-payment-method" class="payment-method-dropdown" required>
                                <option value="">Select Payment Method</option>
                                <option value="Bkash">Bkash</option>
                                <option value="Nagad">Nagad</option>
                                <option value="Rocket">Rocket</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <input type="text" id="mobile-number" class="form-control" placeholder="Your Mobile Number" required>
                        </div>
                        <div class="form-group">
                            <input type="text" id="transaction-id" class="form-control" placeholder="Transaction ID" required>
                        </div>
                    </div>

                    <div class="info-box">
                        আপনার অ্যাকাউন্ট ব্যালেন্স: <span class="highlight-balance" id="balance-info">৳ 0</span>
                    </div>
                    <div class="info-box">
                        প্রোডাক্ট কিনতে আপনার প্রয়োজন: <span class="highlight-cost" id="cost-info">৳ 0.00</span>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer Navigation with 5 items -->
        <nav class="footer-nav">
            <div class="nav-item active" data-page="home-page">
                <i class="fas fa-home"></i>
                <div class="nav-text">Home</div>
            </div>
            <div class="nav-item" data-page="add-money-page">
                <i class="fas fa-money-bill-wave"></i>
                <div class="nav-text">Add Money</div>
            </div>
            <div class="nav-item" data-page="my-orders-page">
                <i class="fas fa-shopping-cart"></i>
                <div class="nav-text">My Orders</div>
            </div>
            <div class="nav-item" data-page="my-transaction-page">
                <i class="fas fa-history"></i>
                <div class="nav-text">Transaction</div>
            </div>
            <div class="nav-item" data-page="account-page">
                <i class="fas fa-user"></i>
                <div class="nav-text">Account</div>
            </div>
        </nav>

        <!-- Fixed Action Bar for Product Detail Page -->
        <div id="product-detail-footer" class="footer-action-bar d-none">
            <button id="buy-now-btn" class="buy-now-btn">BUY NOW</button>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="edit-profile-modal" class="modal-overlay d-none">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Profile</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="edit-profile-form">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="edit-fullname" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>Old Password</label>
                    <input type="password" id="edit-old-password" class="form-control" placeholder="Enter old password to change password">
                    <button type="button" class="password-toggle" id="edit-old-password-toggle">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                <div class="form-group">
                    <label>New Password</label>
                    <input type="password" id="edit-new-password" class="form-control" placeholder="Enter new password">
                    <button type="button" class="password-toggle" id="edit-new-password-toggle">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                <div class="form-group">
                    <label>Confirm New Password</label>
                    <input type="password" id="edit-confirm-password" class="form-control" placeholder="Confirm new password">
                    <button type="button" class="password-toggle" id="edit-confirm-password-toggle">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                <div class="error-message" id="edit-profile-error"></div>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </form>
        </div>
    </div>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- FIREBASE CONFIGURATION ---
            const firebaseConfig = {
                apiKey: "AIzaSyBa9Rj5_qNeysHtW06KzuRWC-YrFROu8eA",
                authDomain: "my-web-957ec.firebaseapp.com",
                projectId: "my-web-957ec",
                storageBucket: "my-web-957ec.firebasestorage.app",
                messagingSenderId: "1020345338199",
                appId: "1:1020345338199:web:4befac3a0d191e5d6cd612",
                measurementId: "G-QSB2X16RTC"
            };
            
            // --- INITIALIZE FIREBASE ---
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const db = firebase.firestore();

            // --- GLOBAL STATE ---
            let currentUser = null;
            let currentProduct = null;
            let globalSettings = {};
            let selectedRechargeOption = null;
            let selectedPaymentMethod = 'wallet';
            let userBalance = 0;
            let productItems = [];
            let userData = {};
            let contactInfo = {}; // Store contact info from Firestore
            let supportInfo = {}; // Store support info from Firestore
            
            // --- UI ELEMENT SELECTORS ---
            const splashScreen = document.getElementById('splash-screen');
            const splashLogo = document.getElementById('splash-logo');
            const progressBar = document.getElementById('progress-bar');
            const banScreen = document.getElementById('ban-screen');
            const loader = document.getElementById('loader');
            const authView = document.getElementById('auth-view');
            const appView = document.getElementById('app-view');
            const mainContent = document.getElementById('main-content');
            const editProfileModal = document.getElementById('edit-profile-modal');
            const editProfileForm = document.getElementById('edit-profile-form');
            
            // --- UTILITY FUNCTIONS ---
            const showLoader = () => loader.classList.remove('d-none');
            const hideLoader = () => loader.classList.add('d-none');
            
            // UPDATED: Enhanced splash screen with progress bar
            const hideSplashScreen = () => {
                splashScreen.style.opacity = '0';
                setTimeout(() => {
                    splashScreen.classList.add('d-none');
                    // Mark as visited in localStorage
                    localStorage.setItem('appVisited', 'true');
                }, 500);
            };

            // Update progress bar
            const updateProgressBar = (percentage) => {
                progressBar.style.width = `${percentage}%`;
            };

            // Check if app has been visited before
            const hasVisitedBefore = () => {
                return localStorage.getItem('appVisited') === 'true';
            };

            // Generate random order ID
            function generateOrderId() {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let result = '';
                for (let i = 0; i < 8; i++) {
                    result += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return result;
            }

            // Toast Notification Function
            function showToast(message, type = 'info') {
                const toastContainer = document.getElementById('toast-container');
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                
                let icon = 'info-circle';
                if (type === 'success') icon = 'check';
                else if (type === 'error') icon = 'exclamation-triangle';
                else if (type === 'warning') icon = 'exclamation-circle';
                
                toast.innerHTML = `
                    <i class="fas fa-${icon}"></i>
                    ${message}
                `;
                toastContainer.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 5000);
            }

            // NEW: Copy Number Function with dynamic data and fallback
            function copyNumber(method) {
                if (contactInfo[method]) {
                    const textToCopy = contactInfo[method];
                    
                    // Modern approach with Clipboard API
                    if (navigator.clipboard && window.isSecureContext) {
                        navigator.clipboard.writeText(textToCopy)
                            .then(() => {
                                const toast = document.getElementById('toast');
                                toast.textContent = `${method} number copied!`;
                                toast.classList.add('show');
                                setTimeout(() => toast.classList.remove('show'), 2000);
                            })
                            .catch(err => {
                                console.error('Failed to copy: ', err);
                                fallbackCopyTextToClipboard(textToCopy, method);
                            });
                    } else {
                        // Fallback for older browsers
                        fallbackCopyTextToClipboard(textToCopy, method);
                    }
                } else {
                    showToast('Phone number not available', 'error');
                }
            }

            // Fallback copy method for older browsers
            function fallbackCopyTextToClipboard(text, method) {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                textArea.style.opacity = "0";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                
                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        const toast = document.getElementById('toast');
                        toast.textContent = `${method} number copied!`;
                        toast.classList.add('show');
                        setTimeout(() => toast.classList.remove('show'), 2000);
                    } else {
                        showToast('Failed to copy number', 'error');
                    }
                } catch (err) {
                    console.error('Fallback copy failed: ', err);
                    showToast('Failed to copy number', 'error');
                }
                
                document.body.removeChild(textArea);
            }

            // NEW: Setup copy button event listeners
            function setupCopyButtons() {
                document.querySelectorAll('.copy-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        e.preventDefault();
                        const method = e.target.dataset.method || e.target.closest('.copy-btn').dataset.method;
                        copyNumber(method);
                    });
                });
            }

            // NEW: Phone Back Button Handler
            function setupBackButtonHandler() {
                // Listen for the backbutton event (for Cordova/PhoneGap)
                document.addEventListener('backbutton', function(e) {
                    e.preventDefault();
                    handleBackButton();
                }, false);
                
                // Also handle browser back button
                window.addEventListener('popstate', function(e) {
                    e.preventDefault();
                    handleBackButton();
                });
            }

            // NEW: Handle back button press
            function handleBackButton() {
                const currentPage = document.querySelector('.app-page:not(.d-none)');
                
                if (currentPage && currentPage.id === 'product-detail-page') {
                    // If we're on product detail page, go back to home
                    switchAppPage('home-page');
                } else if (currentPage && currentPage.id === 'deposit-page') {
                    // If we're on deposit page, go back to add money page
                    switchAppPage('add-money-page');
                } else if (currentPage && currentPage.id !== 'home-page') {
                    // If we're on any other page except home, go to home
                    switchAppPage('home-page');
                } else {
                    // If we're on home page, show exit confirmation or do nothing
                    // You can add exit confirmation here if needed
                    showToast('Press back again to exit', 'info');
                }
            }

            // FIXED: Password Visibility Toggle Function
            function setupPasswordToggle(passwordInputId, toggleButtonId) {
                const passwordInput = document.getElementById(passwordInputId);
                const toggleButton = document.getElementById(toggleButtonId);
                
                if (!passwordInput || !toggleButton) return;
                
                // Ensure proper positioning
                const formGroup = passwordInput.closest('.form-group');
                if (formGroup) {
                    formGroup.style.position = 'relative';
                }
                
                toggleButton.style.position = 'absolute';
                toggleButton.style.right = '15px';
                toggleButton.style.top = '50%';
                toggleButton.style.transform = 'translateY(-50%)';
                toggleButton.style.zIndex = '10';
                toggleButton.style.background = 'none';
                toggleButton.style.border = 'none';
                toggleButton.style.color = 'var(--text-light)';
                toggleButton.style.cursor = 'pointer';
                toggleButton.style.fontSize = '1rem';
                toggleButton.style.height = '20px';
                toggleButton.style.width = '20px';
                toggleButton.style.display = 'flex';
                toggleButton.style.alignItems = 'center';
                toggleButton.style.justifyContent = 'center';
                toggleButton.style.padding = '0';
                
                toggleButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    passwordInput.setAttribute('type', type);
                    
                    const icon = toggleButton.querySelector('i');
                    if (type === 'password') {
                        icon.classList.remove('fa-eye-slash');
                        icon.classList.add('fa-eye');
                    } else {
                        icon.classList.remove('fa-eye');
                        icon.classList.add('fa-eye-slash');
                    }
                });
            }

            // Setup all password toggles
            function setupAllPasswordToggles() {
                setupPasswordToggle('login-password', 'login-password-toggle');
                setupPasswordToggle('signup-password', 'signup-password-toggle');
                setupPasswordToggle('signup-confirm-password', 'signup-confirm-password-toggle');
                setupPasswordToggle('edit-old-password', 'edit-old-password-toggle');
                setupPasswordToggle('edit-new-password', 'edit-new-password-toggle');
                setupPasswordToggle('edit-confirm-password', 'edit-confirm-password-toggle');
            }

            // --- VALIDATION FUNCTIONS ---
            function validateEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            }

            function validatePhoneNumber(phone) {
                const re = /^(?:\+88|01)?\d{11}$/;
                return re.test(phone.replace(/\s/g, ''));
            }

            function validatePlayerId(playerId) {
                return playerId.length >= 3 && playerId.length <= 20;
            }

            // --- VIEW/PAGE SWITCHING LOGIC ---
            function showAuthSubView(viewId) {
                ['login-view', 'signup-view', 'forgot-password-view'].forEach(id => {
                    document.getElementById(id).classList.add('d-none');
                });
                document.getElementById(viewId).classList.remove('d-none');
            }

            function switchAppPage(pageId) {
                mainContent.querySelectorAll('.app-page').forEach(page => page.classList.add('d-none'));
                document.getElementById(pageId).classList.remove('d-none');
                
                if (pageId === 'product-detail-page') {
                    document.querySelector('.footer-nav').classList.add('d-none');
                    document.getElementById('product-detail-footer').classList.remove('d-none');
                } else {
                    document.querySelector('.footer-nav').classList.remove('d-none');
                    document.getElementById('product-detail-footer').classList.add('d-none');
                }
                
                document.querySelectorAll('.footer-nav .nav-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.page === pageId);
                });
                
                if (pageId === 'my-orders-page') {
                    loadMyOrders();
                } else if (pageId === 'my-transaction-page') {
                    loadMyTransactions();
                } else if (pageId === 'account-page') {
                    loadAccountData();
                }
                
                // Update browser history for back button
                if (history && history.pushState) {
                    history.pushState({ page: pageId }, '', `#${pageId}`);
                }
            }

            // --- AUTHENTICATION ---
            // UPDATED: Check if user exists in Firestore when auth state changes
            auth.onAuthStateChanged(async user => {
                if (user) {
                    try {
                        // Check if user document exists in Firestore
                        const userDoc = await db.collection('users').doc(user.uid).get();
                        
                        if (!userDoc.exists) {
                            // User document doesn't exist - sign out and show error
                            await auth.signOut();
                            showToast('Your account has been deleted or does not exist.', 'error');
                            return;
                        }
                        
                        userData = userDoc.data();
                        
                        // Check if user is banned
                        if (userData.banned) {
                            authView.classList.add('d-none');
                            appView.classList.add('d-none');
                            banScreen.classList.remove('d-none');
                            return;
                        }
                        
                        currentUser = user;
                        authView.classList.add('d-none');
                        appView.classList.remove('d-none');
                        
                        await initializeApp();
                        
                    } catch (error) {
                        console.error("Error checking user:", error);
                        showToast('Error loading user data', 'error');
                        await auth.signOut();
                    }
                } else {
                    currentUser = null;
                    authView.classList.remove('d-none');
                    appView.classList.add('d-none');
                    banScreen.classList.add('d-none');
                    showAuthSubView('login-view');
                }
                
                // UPDATED: Enhanced splash screen with progress animation
                if (!hasVisitedBefore()) {
                    // Simulate loading progress
                    let progress = 0;
                    const interval = setInterval(() => {
                        progress += 5;
                        updateProgressBar(progress);
                        
                        if (progress >= 100) {
                            clearInterval(interval);
                            setTimeout(() => {
                                hideSplashScreen();
                            }, 500);
                        }
                    }, 200);
                } else {
                    hideSplashScreen();
                }
            });

            // Login Form
            document.getElementById('login-form').addEventListener('submit', (e) => {
                e.preventDefault();
                showLoader();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                const errorEl = document.getElementById('login-error');
                
                // Validate email
                if (!validateEmail(email)) {
                    errorEl.textContent = "Please enter a valid email address.";
                    hideLoader();
                    return;
                }
                
                auth.signInWithEmailAndPassword(email, password)
                    .catch(error => {
                        errorEl.textContent = error.message;
                    })
                    .finally(hideLoader);
            });

            // UPDATED: Signup Form - Password NOT stored in Firestore
            document.getElementById('signup-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const fullName = document.getElementById('signup-fullname').value;
                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value;
                const confirmPassword = document.getElementById('signup-confirm-password').value;
                const errorEl = document.getElementById('signup-error');
                
                // Validate inputs
                if (fullName.length < 2) {
                    errorEl.textContent = "Please enter a valid full name.";
                    return;
                }
                
                if (!validateEmail(email)) {
                    errorEl.textContent = "Please enter a valid email address.";
                    return;
                }
                
                if (password !== confirmPassword) {
                    errorEl.textContent = "Passwords do not match.";
                    return;
                }
                
                if (password.length < 6) {
                    errorEl.textContent = "Password must be at least 6 characters.";
                    return;
                }
                
                showLoader();
                
                try {
                    // Get total user count for user number
                    const usersSnapshot = await db.collection('users').get();
                    const userNumber = usersSnapshot.size + 1;
                    
                    // Create user in Firebase Authentication
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    
                    // Store user data in Firestore WITHOUT password
                    await db.collection('users').doc(userCredential.user.uid).set({
                        uid: userCredential.user.uid,
                        email: userCredential.user.email,
                        fullName: fullName,
                        walletBalance: 0,
                        totalSpent: 0,
                        userNumber: userNumber,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        banned: false
                    });
                    
                    showToast('Account created successfully!', 'success');
                } catch(error) {
                    errorEl.textContent = error.message;
                    console.error("Signup error:", error);
                } finally {
                    hideLoader();
                }
            });

            // Logout
            document.getElementById('logout-btn').addEventListener('click', () => {
                auth.signOut();
                showToast('Logged out successfully', 'info');
            });

            // Ban Screen Close Button
            document.getElementById('ban-close-btn').addEventListener('click', () => {
                window.close();
                showToast('App will now close', 'info');
            });

            // Forgot Password
            document.getElementById('forgot-password-form').addEventListener('submit', (e) => {
                e.preventDefault();
                showLoader();
                const email = document.getElementById('reset-email').value;
                const messageEl = document.getElementById('reset-message');
                
                // Validate email
                if (!validateEmail(email)) {
                    messageEl.style.color = 'var(--danger)';
                    messageEl.textContent = 'Please enter a valid email address.';
                    hideLoader();
                    return;
                }
                
                auth.sendPasswordResetEmail(email)
                    .then(() => {
                        messageEl.style.color = 'var(--success)';
                        messageEl.textContent = 'Password reset email sent! Check your inbox.';
                    })
                    .catch(error => {
                        messageEl.style.color = 'var(--danger)';
                        messageEl.textContent = error.message;
                    })
                    .finally(hideLoader);
            });

            // Auth View Switching
            document.getElementById('show-signup-link').addEventListener('click', (e) => {
                e.preventDefault();
                showAuthSubView('signup-view');
            });
            
            document.getElementById('show-login-link').addEventListener('click', (e) => {
                e.preventDefault();
                showAuthSubView('login-view');
            });
            
            document.getElementById('forgot-password-link').addEventListener('click', (e) => {
                e.preventDefault();
                showAuthSubView('forgot-password-view');
            });
            
            document.getElementById('back-to-login-link').addEventListener('click', (e) => {
                e.preventDefault();
                showAuthSubView('login-view');
            });
            
            // Edit Profile Modal
            document.getElementById('edit-profile-btn').addEventListener('click', () => {
                openEditProfileModal();
            });
            
            editProfileModal.querySelector('.modal-close').addEventListener('click', () => {
                editProfileModal.classList.add('d-none');
            });
            
            editProfileForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                showLoader();
                
                const fullName = document.getElementById('edit-fullname').value;
                const oldPassword = document.getElementById('edit-old-password').value;
                const newPassword = document.getElementById('edit-new-password').value;
                const confirmPassword = document.getElementById('edit-confirm-password').value;
                const errorEl = document.getElementById('edit-profile-error');
                
                try {
                    // Update full name if changed
                    if (fullName !== userData.fullName) {
                        await db.collection('users').doc(currentUser.uid).update({
                            fullName: fullName
                        });
                    }
                    
                    // Update password if provided
                    if (oldPassword && newPassword) {
                        if (newPassword !== confirmPassword) {
                            throw new Error('New passwords do not match.');
                        }
                        
                        if (newPassword.length < 6) {
                            throw new Error('New password must be at least 6 characters.');
                        }
                        
                        // Reauthenticate user
                        const credential = firebase.auth.EmailAuthProvider.credential(
                            currentUser.email, 
                            oldPassword
                        );
                        
                        await currentUser.reauthenticateWithCredential(credential);
                        await currentUser.updatePassword(newPassword);
                    }
                    
                    showToast('Profile updated successfully!', 'success');
                    editProfileModal.classList.add('d-none');
                    loadAccountData();
                } catch (error) {
                    errorEl.textContent = error.message;
                } finally {
                    hideLoader();
                }
            });
            
            function openEditProfileModal() {
                document.getElementById('edit-fullname').value = userData.fullName || '';
                document.getElementById('edit-old-password').value = '';
                document.getElementById('edit-new-password').value = '';
                document.getElementById('edit-confirm-password').value = '';
                document.getElementById('edit-profile-error').textContent = '';
                editProfileModal.classList.remove('d-none');
            }
            
            // --- FIRESTORE DATA & APP LOGIC ---
            async function initializeApp() {
                try {
                    await loadSettings();
                    await loadContactInfo(); // Load contact info from Firestore
                    await loadSupportInfo(); // Load support info from Firestore
                    await loadProductItems();
                    await loadProducts();
                    listenToUserData();
                    setupAllPasswordToggles();
                    setupCopyButtons(); // Setup copy buttons
                    setupBackButtonHandler(); // Setup back button handler
                    switchAppPage('home-page');
                } catch (error) {
                    console.error("Error initializing app:", error);
                    showToast('Error loading app data', 'error');
                }
            }

            // NEW: Load Contact Info from Firestore
            async function loadContactInfo() {
                try {
                    const doc = await db.collection('configs').doc('contact_info').get();
                    if (doc.exists) {
                        contactInfo = doc.data();
                        updateContactInfoUI();
                    } else {
                        console.log("No contact info document found!");
                        // Set default values if no document exists
                        contactInfo = {
                            bkash: "01327870169",
                            nagad: "01327870169",
                            rocket: "01327870169"
                        };
                        updateContactInfoUI();
                    }
                } catch (error) {
                    console.error("Error loading contact info: ", error);
                    // Set default values on error
                    contactInfo = {
                        bkash: "01327870169",
                        nagad: "01327870169",
                        rocket: "01327870169"
                    };
                    updateContactInfoUI();
                }
            }

            // NEW: Load Support Info from Firestore
            async function loadSupportInfo() {
                try {
                    const doc = await db.collection('configs').doc('support_info').get();
                    if (doc.exists) {
                        supportInfo = doc.data();
                        updateSupportInfoUI();
                    } else {
                        console.log("No support info document found!");
                        // Set default values if no document exists
                        supportInfo = {
                            support_email: "support@zonetopup.com",
                            whatsapp_number: "+8801234567890",
                            telegram_link: "@zonetopup",
                            youtube_link: "https://youtube.com/zonetopup",
                            facebook_link: "https://facebook.com/zonetopup"
                        };
                        updateSupportInfoUI();
                    }
                } catch (error) {
                    console.error("Error loading support info: ", error);
                    // Set default values on error
                    supportInfo = {
                        support_email: "support@zonetopup.com",
                        whatsapp_number: "+8801234567890",
                        telegram_link: "@zonetopup",
                        youtube_link: "https://youtube.com/zonetopup",
                        facebook_link: "https://facebook.com/zonetopup"
                    };
                    updateSupportInfoUI();
                }
            }

            // NEW: Update UI with contact info
            function updateContactInfoUI() {
                // Update deposit page numbers
                if (contactInfo.bkash) {
                    const bkashNumberEl = document.getElementById('bkashNumber');
                    if (bkashNumberEl) bkashNumberEl.textContent = contactInfo.bkash;
                }
                if (contactInfo.nagad) {
                    const nagadNumberEl = document.getElementById('nagadNumber');
                    if (nagadNumberEl) nagadNumberEl.textContent = contactInfo.nagad;
                }
                if (contactInfo.rocket) {
                    const rocketNumberEl = document.getElementById('rocketNumber');
                    if (rocketNumberEl) rocketNumberEl.textContent = contactInfo.rocket;
                }

                // Update product detail page numbers
                if (contactInfo.bkash) {
                    const instantBkashNumberEl = document.getElementById('instant-bkash-number');
                    if (instantBkashNumberEl) instantBkashNumberEl.textContent = contactInfo.bkash;
                }
                if (contactInfo.nagad) {
                    const instantNagadNumberEl = document.getElementById('instant-nagad-number');
                    if (instantNagadNumberEl) instantNagadNumberEl.textContent = contactInfo.nagad;
                }
                if (contactInfo.rocket) {
                    const instantRocketNumberEl = document.getElementById('instant-rocket-number');
                    if (instantRocketNumberEl) instantRocketNumberEl.textContent = contactInfo.rocket;
                }
            }

            // NEW: Update UI with support info
            function updateSupportInfoUI() {
                // Update support email
                if (supportInfo.support_email) {
                    const supportEmailEl = document.getElementById('support-email');
                    const supportEmailLink = document.getElementById('support-email-link');
                    if (supportEmailEl) supportEmailEl.textContent = supportInfo.support_email;
                    if (supportEmailLink) supportEmailLink.href = `mailto:${supportInfo.support_email}`;
                }

                // Update WhatsApp
                if (supportInfo.whatsapp_number) {
                    const whatsappNumberEl = document.getElementById('whatsapp-number');
                    const whatsappLink = document.getElementById('whatsapp-link');
                    if (whatsappNumberEl) whatsappNumberEl.textContent = supportInfo.whatsapp_number;
                    if (whatsappLink) whatsappLink.href = `https://wa.me/${supportInfo.whatsapp_number.replace('+', '')}`;
                }

                // Update Telegram
                if (supportInfo.telegram_link) {
                    const telegramLinkTextEl = document.getElementById('telegram-link-text');
                    const telegramLink = document.getElementById('telegram-link');
                    if (telegramLinkTextEl) telegramLinkTextEl.textContent = supportInfo.telegram_link;
                    if (telegramLink) telegramLink.href = `https://t.me/${supportInfo.telegram_link.replace('@', '')}`;
                }

                // Update YouTube
                if (supportInfo.youtube_link) {
                    const youtubeLink = document.getElementById('youtube-link');
                    if (youtubeLink) youtubeLink.href = supportInfo.youtube_link;
                }

                // Update Facebook
                if (supportInfo.facebook_link) {
                    const facebookLink = document.getElementById('facebook-link');
                    if (facebookLink) facebookLink.href = supportInfo.facebook_link;
                }
            }

            // Load Global Settings
            async function loadSettings() {
                try {
                    const doc = await db.collection('settings').doc('global').get();
                    if (doc.exists) {
                        const settings = doc.data();
                        globalSettings = settings;
                        
                        const appName = settings.appName || 'TopUp Center';
                        splashLogo.textContent = appName;
                        document.getElementById('login-app-name').textContent = appName;
                        document.getElementById('signup-app-name').textContent = `Join ${appName}`;
                        document.getElementById('app-name-header').textContent = appName;
                        document.getElementById('app-name-payment').textContent = appName;
                        document.getElementById('notice-text').textContent = settings.notice || '';

                        // UPDATED: Slider with manual and auto scroll
                        const slider = document.getElementById('image-slider');
                        const sliderDots = document.getElementById('slider-dots');
                        slider.innerHTML = '';
                        sliderDots.innerHTML = '';
                        
                        const sliderData = [
                            { url: settings.slider_url_1, link: settings.slider_link_1 },
                            { url: settings.slider_url_2, link: settings.slider_link_2 },
                            { url: settings.slider_url_3, link: settings.slider_link_3 }
                        ].filter(slide => slide.url); // Filter out empty slides
                        
                        sliderData.forEach((slide, index) => {
                            if (slide.url) {
                                if (slide.link) {
                                    slider.innerHTML += `
                                        <div class="slide">
                                            <a href="${slide.link}" target="_blank" rel="noopener noreferrer">
                                                <img src="${slide.url}" alt="Banner">
                                            </a>
                                        </div>
                                    `;
                                } else {
                                    slider.innerHTML += `<div class="slide"><img src="${slide.url}" alt="Banner"></div>`;
                                }
                                
                                // Add dot
                                sliderDots.innerHTML += `<div class="slider-dot ${index === 0 ? 'active' : ''}" data-index="${index}"></div>`;
                            }
                        });
                        
                        if (sliderData.length > 0) {
                            initSlider();
                        }

                    } else {
                        console.log("No settings document!");
                    }
                } catch (error) {
                    console.error("Error loading settings: ", error);
                }
            }

            // UPDATED: Slider with manual and auto scroll
            function initSlider() {
                const slider = document.getElementById('image-slider');
                const dots = document.querySelectorAll('.slider-dot');
                const totalSlides = slider.children.length;
                
                if (totalSlides <= 1) return;
                
                let currentIndex = 0;
                let startX = 0;
                let isDragging = false;
                let autoScrollInterval;
                
                // Auto scroll function
                function startAutoScroll() {
                    autoScrollInterval = setInterval(() => {
                        currentIndex = (currentIndex + 1) % totalSlides;
                        updateSlider();
                    }, 3000);
                }
                
                function stopAutoScroll() {
                    clearInterval(autoScrollInterval);
                }
                
                function updateSlider() {
                    slider.style.transform = `translateX(-${currentIndex * 100}%)`;
                    
                    // Update dots
                    dots.forEach((dot, index) => {
                        dot.classList.toggle('active', index === currentIndex);
                    });
                }
                
                // Touch events for manual scroll
                slider.parentElement.addEventListener('touchstart', (e) => {
                    startX = e.touches[0].clientX;
                    isDragging = true;
                    stopAutoScroll();
                });
                
                slider.parentElement.addEventListener('touchmove', (e) => {
                    if (!isDragging) return;
                    const currentX = e.touches[0].clientX;
                    const diff = startX - currentX;
                    
                    if (Math.abs(diff) > 50) {
                        if (diff > 0 && currentIndex < totalSlides - 1) {
                            // Swipe left
                            currentIndex++;
                        } else if (diff < 0 && currentIndex > 0) {
                            // Swipe right
                            currentIndex--;
                        }
                        updateSlider();
                        startX = currentX;
                    }
                });
                
                slider.parentElement.addEventListener('touchend', () => {
                    isDragging = false;
                    // Restart auto scroll after manual interaction
                    setTimeout(startAutoScroll, 5000);
                });
                
                // Click events for dots
                dots.forEach(dot => {
                    dot.addEventListener('click', () => {
                        currentIndex = parseInt(dot.dataset.index);
                        updateSlider();
                        stopAutoScroll();
                        // Restart auto scroll after manual interaction
                        setTimeout(startAutoScroll, 5000);
                    });
                });
                
                // Start auto scroll
                startAutoScroll();
                
                // Pause on hover
                slider.parentElement.addEventListener('mouseenter', stopAutoScroll);
                slider.parentElement.addEventListener('mouseleave', startAutoScroll);
            }

            // Load Product Items from Firestore
            async function loadProductItems() {
                try {
                    const snapshot = await db.collection('product_items').where('status', '==', 'In Stock').get();
                    productItems = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                } catch (error) {
                    console.error("Error loading product items: ", error);
                    productItems = [];
                }
            }

            // Product Loading Function
            async function loadProducts() {
                try {
                    const categoriesSnap = await db.collection('categories').orderBy('order', 'asc').get();
                    const categories = categoriesSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    
                    const productsSnap = await db.collection('products').get();
                    const products = productsSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    
                    const productsByCategory = {};
                    categories.forEach(cat => {
                        productsByCategory[cat.name] = products.filter(p => p.category === cat.name);
                    });

                    const productListEl = document.getElementById('product-list');
                    productListEl.innerHTML = '';
                    
                    if (categories.length === 0) {
                        productListEl.innerHTML = '<div class="text-center">No categories available.</div>';
                        return;
                    }
                    
                    for (const category of categories) {
                        const categoryProducts = productsByCategory[category.name] || [];
                        
                        if (categoryProducts.length === 0) continue;
                        
                        const categorySection = document.createElement('div');
                        categorySection.className = 'category-section';
                        categorySection.innerHTML = `<h2 class="category-title">${category.name}</h2>`;
                        
                        const grid = document.createElement('div');
                        grid.className = 'product-grid';
                        
                        const displayProducts = categoryProducts.slice(0, 10);
                        
                        displayProducts.forEach(product => {
                            const isOutOfStock = product.status === 'Out of Stock';
                            const isComingSoon = product.status === 'Coming Soon';
                            
                            grid.innerHTML += `
                                <div class="product-card ${isOutOfStock ? 'out-of-stock' : ''}" 
                                     data-product-id="${product.id}"
                                     data-product-name="${product.name}"
                                     data-product-image="${product.imageUrl}"
                                     data-product-category="${product.category}">
                                    ${isComingSoon ? '<span class="coming-soon-badge">Coming Soon</span>' : ''}
                                    <img src="${product.imageUrl}" alt="${product.name}">
                                    <div class="product-info">
                                        <div class="product-name">${product.name}</div>
                                    </div>
                                </div>
                            `;
                        });
                        
                        categorySection.appendChild(grid);
                        productListEl.appendChild(categorySection);
                    }
                } catch (error) {
                    console.error("Error loading products: ", error);
                    document.getElementById('product-list').innerHTML = '<div class="text-center">Error loading products.</div>';
                }
            }
            
            // Listen to User Data
            function listenToUserData() {
                if (!currentUser) return;
                
                db.collection('users').doc(currentUser.uid).onSnapshot(doc => {
                    if (!doc.exists) {
                        // User document deleted - sign out
                        auth.signOut();
                        showToast('Your account has been deleted.', 'error');
                        return;
                    }
                    
                    const userData = doc.data();
                    if (userData) {
                        userBalance = userData.walletBalance || 0;
                        document.getElementById('wallet-balance-value').textContent = `৳ ${userBalance.toFixed(2)}`;
                        document.getElementById('wallet-balance-display').textContent = userBalance.toFixed(2);
                        document.getElementById('balance-info').textContent = `৳ ${userBalance.toFixed(2)}`;
                        document.getElementById('user-email-display').textContent = userData.email;
                        
                        if (document.getElementById('account-page').classList.contains('d-none') === false) {
                            loadAccountData();
                        }
                    }
                });
            }
            
            // Load My Orders
            async function loadMyOrders() {
                if (!currentUser) return;
                
                try {
                    const snapshot = await db.collection('users').doc(currentUser.uid).collection('orders').orderBy('timestamp', 'desc').get();
                    const ordersListEl = document.getElementById('orders-list');
                    ordersListEl.innerHTML = '';
                    
                    if (snapshot.empty) {
                        ordersListEl.innerHTML = '<p>No orders found.</p>';
                        return;
                    }
                    
                    snapshot.forEach(doc => {
                        const order = doc.data();
                        const date = order.timestamp ? new Date(order.timestamp.toDate()).toLocaleString() : 'N/A';
                        const orderId = doc.id.substring(0, 8).toUpperCase();
                        const productName = order.productName || 'N/A';
                        
                        ordersListEl.innerHTML += `
                            <div class="order-card">
                                <div class="order-header">
                                    <div class="order-id">Order #${orderId}</div>
                                    <div class="order-date">${date}</div>
                                </div>
                                <div class="order-details">
                                    <div class="order-detail-row">
                                        <span class="order-detail-label">Package:</span>
                                        <span class="order-detail-value">${productName}</span>
                                    </div>
                                    <div class="order-detail-row">
                                        <span class="order-detail-label">Total Price:</span>
                                        <span class="order-detail-value">৳${order.price || 0}</span>
                                    </div>
                                    <div class="order-detail-row">
                                        <span class="order-detail-label">Player ID:</span>
                                        <span class="order-detail-value">${order.playerID || 'N/A'}</span>
                                    </div>
                                </div>
                                <div class="order-status status-${order.status?.toLowerCase()}">${order.status || 'Pending'}</div>
                            </div>
                        `;
                    });
                } catch (error) {
                    console.error("Error loading orders: ", error);
                    document.getElementById('orders-list').innerHTML = '<p>Error loading orders.</p>';
                }
            }
            
            // Load My Transactions
            async function loadMyTransactions() {
                if (!currentUser) return;
                
                try {
                    const snapshot = await db.collection('users').doc(currentUser.uid).collection('deposits').orderBy('timestamp', 'desc').get();
                    const transactionsListEl = document.getElementById('transactions-list');
                    transactionsListEl.innerHTML = '';
                    
                    if (snapshot.empty) {
                        transactionsListEl.innerHTML = '<p>No transactions found.</p>';
                        return;
                    }
                    
                    snapshot.forEach(doc => {
                        const transaction = doc.data();
                        const date = transaction.timestamp ? new Date(transaction.timestamp.toDate()).toLocaleString() : 'N/A';
                        
                        transactionsListEl.innerHTML += `
                            <div class="transaction-card">
                                <div class="transaction-header">
                                    <div class="order-status status-${transaction.status?.toLowerCase()}">${transaction.status || 'Pending'}</div>
                                    <div class="transaction-amount">৳${transaction.amount || 0}</div>
                                </div>
                                <div class="transaction-details">
                                    <div class="transaction-detail">
                                        <span class="transaction-label">Phone:</span>
                                        <span class="transaction-value">${transaction.senderNumber || 'N/A'}</span>
                                    </div>
                                    <div class="transaction-detail">
                                        <span class="transaction-label">Trx ID:</span>
                                        <span class="transaction-value">${transaction.transactionId || 'N/A'}</span>
                                    </div>
                                    <div class="transaction-detail">
                                        <span class="transaction-label">Date:</span>
                                        <span class="transaction-value">${date}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                } catch (error) {
                    console.error("Error loading transactions: ", error);
                    document.getElementById('transactions-list').innerHTML = '<p>Error loading transactions.</p>';
                }
            }
            
            // Load Account Data
            async function loadAccountData() {
                if (!currentUser) return;
                
                try {
                    const userDoc = await db.collection('users').doc(currentUser.uid).get();
                    if (userDoc.exists) {
                        userData = userDoc.data();
                        
                        const firstName = userData.fullName ? userData.fullName.charAt(0).toUpperCase() : 'U';
                        document.getElementById('user-avatar').textContent = firstName;
                        document.getElementById('user-fullname').textContent = userData.fullName || 'User';
                        document.getElementById('user-email-display').textContent = userData.email || 'N/A';
                        document.getElementById('user-id-display').textContent = `#${userData.userNumber || '000000'}`;
                        document.getElementById('total-wallet').textContent = `৳${userData.walletBalance || 0}`;
                        
                        const ordersSnap = await db.collection('users').doc(currentUser.uid).collection('orders').where('status', '==', 'Completed').get();
                        let totalSpent = 0;
                        
                        ordersSnap.forEach(doc => {
                            const order = doc.data();
                            totalSpent += order.price || 0;
                        });
                        
                        document.getElementById('total-spent').textContent = `৳${totalSpent.toFixed(2)}`;
                        document.getElementById('total-orders').textContent = ordersSnap.size;
                    }
                } catch (error) {
                    console.error("Error loading account data: ", error);
                }
            }
            
            // --- INTERACTIONS ---

            // Footer Navigation
            document.querySelector('.footer-nav').addEventListener('click', (e) => {
                const navItem = e.target.closest('.nav-item');
                if (navItem) {
                    switchAppPage(navItem.dataset.page);
                }
            });

            // Add Money Options
            document.getElementById('auto-add-money').addEventListener('click', () => {
                showToast('Auto Add Money feature coming soon!'